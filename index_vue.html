<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="description" content="Yxscalc : Simple tool calculate data.">

  <script src="3rd/lodash.min.js"></script>
  <script src="3rd/jquery-1.11.2.min.js"></script>
  <script src="3rd/vue.js"></script>
  <link rel="stylesheet" href="3rd/bootstrap-3.3.2-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="3rd/bootstrap-3.3.2-dist/css/bootstrap-theme.min.css">
  <!--<script src="3rd/bootstrap-3.3.2-dist/js/bootstrap.min.js"></script>
    -->
</head>

<body>

  <div id="table_order">
    <div class="container-fluid">
      <div class="row">
        <div class="row form-inline">
          <div class="form-group col-xs-2">
            <label for="page_input">{{ res.page }}</label>
            <button type="button" class="btn btn-info btn-xs" @click="before"><</button>
            <input type="text" class="form-control" id="page_input" placeholder="{{ res.page }}" style="width:60px" v-model="page">
            <button type="button" class="btn btn-info btn-xs" @click="after">></button>
          </div>
          <div class="form-group col-xs-2">
            <label for="pagesize_input">{{ res.page_size }}</label>
            <input type="text" class="form-control" id="pagesize_input" placeholder="{{ res.page_size }}" style="width:60px" v-model="page_size">
          </div>
          <div class="form-group col-xs-4">
            <input type="text" class="form-control" placeholder="{{ res.search }}" v-model="keyword">
          </div>
          <div class="form-group col-xs-2">
            <label for="pagesize_input">{{ res.rows_count }}</label>
            <span>: {{rows_count}}</span>
          </div>
        </div>
      </div>

    </div>
    <table class="table table-condensed table-striped table-bordered table-hover">
      <tr>
        <th v-for="key in keys">
          {{key.name}}
        </th>
      </tr>
      <tr v-for="row in rows_show">
        <td v-for="item in row">{{item}}</td>
      </tr>
    </table>

  </div>

  <script>

 var d_table={
    keys: [
      { name: 'orderid' },
      { name: 'status' },
      { name: 'latest' },
      { name: 'detail' }
    ], 
    rows: [
    ]
  }

  for(var i=0;i<30000;i++)
  {
    d_table.rows.push(
      ["orderid"+i,"status"+i, "latest"+i,"detail"+i]
    )
  }

var res={
  "page":"页数",
  "page_size":"页大小",
  "search":"搜索",
  "rows_count":"行数"
};

var m_table = new Vue({
  el: '#table_order',
  data: {
    keys:d_table.keys,
    rows:d_table.rows,
    page:1,
    page_size:10,
    res:res,
    keyword:""
  },
  methods:{
    before: function (event) {
      this.page--
    },     
    after: function (event) {
      this.page++
    }
  },
  computed: {
    // 一个计算属性的 getter
    rows_count: function () {
      // `this` 指向 vm 实例
      return this.rows_filter.length;
    },
    rows_filter:function()
    {
      var that=this;
      var fi_row=that.rows.filter(function(d){
      var rowstring=JSON.stringify(d);
        return rowstring.match(that.keyword);
      });  
      return fi_row;
    },
    rows_show:function(){
      var that=this;
      var rows_filter=that.rows_filter;
      var page = parseInt(that.page);
      var page_size = parseInt(that.page_size);

      var index = (page-1)*page_size;
      if(index >= rows_filter.length){
        var page_end = Math.round(rows_filter.length / page_size)
        that.page=page_end;
        index = (page_end-1)*page_size;
      }
      if(index < 0){
         index=0;
         that.page=1;
      }
      var ret= rows_filter.slice(index, index + page_size);
      return ret;
    }
  }
})


</script>

</body>

</html>